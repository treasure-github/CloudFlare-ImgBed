"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[349],{5349:function(e,t,a){a.r(t),a.d(t,{default:function(){return de}});var l=a(9114),i=(a(5331),a(694),a(2006)),s=(a(8642),a(3003),a(6810)),n=(a(4396),a(4885),a(7377)),r=(a(5616),a(753)),o=(a(415),a(3565),a(4275)),d=(a(1008),a(7410),a(4880)),c=(a(10),a(4968),a(7815)),h=(a(5534),a(7009)),m=(a(8450),a(683)),u=(a(5385),a(47)),f=(a(9648),a(850)),p=(a(8736),a(1095)),g=(a(7128),a(1450)),b=(a(213),a(9017)),F=(a(6055),a(8830),a(3597),a(2105)),k=(a(9092),a(3496)),v=a(6768),w=a(4232),y=a(5130);const $={class:"container"},L={class:"header-content"},T={class:"search-card"},U={class:"stats"},C={class:"actions"},D={class:"el-dropdown-link"},_={class:"el-dropdown-link"},x={class:"el-dropdown-link"},W={class:"breadcrumb"},E={class:"content"},P=["onClick"],S={class:"folder-overlay"},I={class:"folder-actions"},V={class:"file-info"},B={class:"file-short-info"},z={key:0,class:"success-tag"},A={key:1,class:"fail-tag"},N={key:2,class:"success-tag"},M=["src"],X={key:2,class:"file-preview"},j={class:"image-overlay"},q={class:"overlay-buttons"},O={class:"button-row"},G={class:"button-row"},R={class:"file-info"},Z={class:"pagination-container"},Q={class:"pagination-right"},H={class:"detail-actions"},K=["src"],J={style:{"font-size":"medium","font-weight":"bold"}},Y={class:"dialog-action"};function ee(e,t,a,ee,te,ae){const le=k.A,ie=F.WK,se=(0,v.g2)("font-awesome-icon"),ne=b.c6,re=b.Iy,oe=b.dW,de=g.R7,ce=d.bZ,he=p.WZ,me=p.vp,ue=f.dI,fe=u.S2,pe=m.Ik,ge=h.Zq,be=c.aQ,Fe=d.ZO,ke=d.lX,ve=o.v$,we=o.q,ye=r.MF,$e=r.TS,Le=n.kZ,Te=s.ll,Ue=s.MQ,Ce=i.xE,De=i.US,_e=l.L;return(0,v.uX)(),(0,v.CE)("div",$,[(0,v.bF)(ke,null,{default:(0,v.k6)((()=>[(0,v.bF)(ce,null,{default:(0,v.k6)((()=>[(0,v.Lk)("div",L,[(0,v.bF)(le,{activeTab:"dashboard"}),(0,v.Lk)("div",T,[(0,v.bF)(ie,{modelValue:te.search,"onUpdate:modelValue":t[0]||(t[0]=e=>te.search=e),size:"mini",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),(0,v.Lk)("span",U,[(0,v.bF)(se,{icon:"database",class:"fa-database"}),(0,v.eW)(" 文件数量: "+(0,w.v_)(te.Number),1)]),(0,v.Lk)("div",C,[(0,v.bF)(oe,{onCommand:ae.sort,"hide-on-click":!1},{dropdown:(0,v.k6)((()=>[(0,v.bF)(re,null,{default:(0,v.k6)((()=>[(0,v.bF)(ne,{command:"dateDesc"},{default:(0,v.k6)((()=>t[22]||(t[22]=[(0,v.eW)("按时间倒序")]))),_:1}),(0,v.bF)(ne,{command:"nameAsc"},{default:(0,v.k6)((()=>t[23]||(t[23]=[(0,v.eW)("按名称升序")]))),_:1})])),_:1})])),default:(0,v.k6)((()=>[(0,v.Lk)("span",D,[(0,v.bF)(se,{icon:ae.sortIcon,class:"header-icon"},null,8,["icon"])])])),_:1},8,["onCommand"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"全屏",placement:"bottom"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"fa-th",class:"header-icon",onClick:ae.showFullScreen},null,8,["onClick"])])),_:1},8,["disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"全选此页",placement:"bottom"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:ae.selectPageIcon,class:"header-icon",onClick:ae.handleSelectPage},null,8,["icon","onClick"])])),_:1},8,["disabled"]),(0,v.bF)(oe,{onCommand:ae.handleBatchAction,"hide-on-click":!1,disabled:0===te.selectedFiles.length},{dropdown:(0,v.k6)((()=>[(0,v.bF)(re,null,{default:(0,v.k6)((()=>[(0,v.bF)(ne,{command:"copy"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"copy",style:{"margin-right":"5px"}}),t[24]||(t[24]=(0,v.eW)(" 复制 "))])),_:1}),(0,v.bF)(ne,{command:"delete"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"trash-alt",style:{"margin-right":"5px"}}),t[25]||(t[25]=(0,v.eW)(" 删除 "))])),_:1}),(0,v.bF)(ne,{command:"download"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"download",style:{"margin-right":"5px"}}),t[26]||(t[26]=(0,v.eW)(" 下载 "))])),_:1}),(0,v.bF)(ne,{command:"move"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"file-export",style:{"margin-right":"5px"}}),t[27]||(t[27]=(0,v.eW)(" 移动 "))])),_:1}),(0,v.bF)(ne,{command:"ban"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"ban",style:{"margin-right":"5px"}}),t[28]||(t[28]=(0,v.eW)(" 加入黑名单 "))])),_:1}),(0,v.bF)(ne,{command:"white"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"user-plus",style:{"margin-right":"5px"}}),t[29]||(t[29]=(0,v.eW)(" 加入白名单 "))])),_:1})])),_:1})])),default:(0,v.k6)((()=>[(0,v.Lk)("span",_,[(0,v.bF)(se,{icon:"ellipsis-h",class:(0,w.C4)(["header-icon",{disabled:0===te.selectedFiles.length}])},null,8,["class"])])])),_:1},8,["onCommand","disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"链接格式",placement:"bottom"},{default:(0,v.k6)((()=>[(0,v.Lk)("span",x,[(0,v.bF)(se,{icon:"link",class:"header-icon",onClick:t[1]||(t[1]=e=>te.showUrlDialog=!0)})])])),_:1},8,["disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"sign-out-alt",class:"header-icon",onClick:ae.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,v.bF)(Fe,{class:"main-container"},{default:(0,v.k6)((()=>[(0,v.Lk)("div",W,[(0,v.bF)(me,{separator:"/"},{default:(0,v.k6)((()=>[(0,v.bF)(he,{onClick:t[2]||(t[2]=e=>ae.navigateToFolder(""))},{default:(0,v.k6)((()=>t[30]||(t[30]=[(0,v.eW)("根目录")]))),_:1}),((0,v.uX)(!0),(0,v.CE)(v.FK,null,(0,v.pI)(te.currentPath.split("/").filter(Boolean),((e,t)=>((0,v.uX)(),(0,v.Wv)(he,{key:t,onClick:e=>ae.navigateToFolder(te.currentPath.split("/").slice(0,t+1).join("/"))},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})]),(0,v.bo)(((0,v.uX)(),(0,v.CE)("div",E,[((0,v.uX)(!0),(0,v.CE)(v.FK,null,(0,v.pI)(ae.paginatedTableData,((e,a)=>((0,v.uX)(),(0,v.CE)(v.FK,{key:a},[ae.isFolder(e)?((0,v.uX)(),(0,v.Wv)(pe,{key:0,class:"img-card folder-card"},{default:(0,v.k6)((()=>[(0,v.bF)(ue,{modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t},null,8,["modelValue","onUpdate:modelValue"]),(0,v.Lk)("div",{class:"folder-icon",onClick:t=>ae.enterFolder(e.name)},[(0,v.bF)(se,{icon:"folder-open",size:"4x"})],8,P),(0,v.Lk)("div",S,[(0,v.Lk)("div",I,[(0,v.bF)(de,{disabled:ae.disableTooltip,content:"删除",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"danger",onClick:(0,y.D$)((t=>ae.handleDelete(a,e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"trash-alt"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"移动",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"primary",onClick:(0,y.D$)((t=>ae.handleMove(a,e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"file-export"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"])])]),(0,v.Lk)("div",V,(0,w.v_)(ae.getFolderName(e.name)),1)])),_:2},1024)):((0,v.uX)(),(0,v.Wv)(pe,{key:1,class:"img-card"},{default:(0,v.k6)((()=>[(0,v.bF)(ue,{modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t},null,8,["modelValue","onUpdate:modelValue"]),(0,v.Lk)("div",B,["White"===e.metadata?.ListType?((0,v.uX)(),(0,v.CE)("div",z,(0,w.v_)(e.channelTag),1)):"Block"===e.metadata?.ListType||"adult"===e.metadata?.Label?((0,v.uX)(),(0,v.CE)("div",A,(0,w.v_)(e.channelTag),1)):((0,v.uX)(),(0,v.CE)("div",N,(0,w.v_)(e.channelTag),1))]),ae.isVideo(e)?((0,v.uX)(),(0,v.CE)("video",{key:0,src:"/file/"+e.name+"?from=admin",autoplay:"",muted:"",loop:"",class:"video-preview",onClick:t[3]||(t[3]=(...e)=>ae.handleVideoClick&&ae.handleVideoClick(...e))},null,8,M)):ae.isImage(e)?((0,v.uX)(),(0,v.Wv)(ge,{key:1,"preview-teleported":!0,src:"/file/"+e.name+"?from=admin","preview-src-list":e.previewSrcList,fit:"cover",lazy:"",class:"image-preview"},null,8,["src","preview-src-list"])):((0,v.uX)(),(0,v.CE)("div",X,[(0,v.bF)(se,{icon:"file",class:"file-icon",size:"4x"})])),(0,v.Lk)("div",j,[(0,v.Lk)("div",q,[(0,v.Lk)("div",O,[(0,v.bF)(de,{disabled:ae.disableTooltip,content:"复制链接",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"primary",onClick:(0,y.D$)((t=>ae.handleCopy(a,e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"copy"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"下载",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"primary",onClick:(0,y.D$)((t=>ae.handleDownload(e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"download"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"])]),(0,v.Lk)("div",G,[(0,v.bF)(de,{disabled:ae.disableTooltip,content:"详情",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"primary",onClick:(0,y.D$)((t=>ae.openDetailDialog(a,e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"info"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"移动",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"primary",onClick:(0,y.D$)((t=>ae.handleMove(a,e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"file-export"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"]),(0,v.bF)(de,{disabled:ae.disableTooltip,content:"删除",placement:"top"},{default:(0,v.k6)((()=>[(0,v.bF)(fe,{size:"mini",type:"danger",onClick:(0,y.D$)((t=>ae.handleDelete(a,e.name)),["stop"])},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"trash-alt"})])),_:2},1032,["onClick"])])),_:2},1032,["disabled"])])])]),(0,v.Lk)("div",R,(0,w.v_)(ae.getFileName(e.metadata?.FileName||e.name)),1)])),_:2},1024))],64)))),128))])),[[_e,te.loading]]),(0,v.Lk)("div",Z,[(0,v.bF)(be,{background:"",layout:"prev, pager, next",total:ae.filteredTableData.length,"page-size":te.pageSize,"current-page":te.currentPage,onCurrentChange:ae.handlePageChange},null,8,["total","page-size","current-page","onCurrentChange"]),(0,v.Lk)("div",Q,[(0,v.bF)(fe,{type:"primary",onClick:ae.refreshFileList,class:"refresh-btn"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"sync",class:(0,w.C4)({"fa-spin":te.refreshLoading})},null,8,["class"])])),_:1},8,["onClick"]),te.currentPage===Math.ceil(ae.filteredTableData.length/te.pageSize)?((0,v.uX)(),(0,v.Wv)(fe,{key:0,type:"primary",onClick:ae.loadMoreData,loading:te.loading,class:"load-more"},{default:(0,v.k6)((()=>t[31]||(t[31]=[(0,v.eW)(" 加载更多 ")]))),_:1},8,["onClick","loading"])):(0,v.Q3)("",!0)])])])),_:1})])),_:1}),(0,v.bF)(Le,{title:"文件详情",modelValue:te.showdetailDialog,"onUpdate:modelValue":t[16]||(t[16]=e=>te.showdetailDialog=e),width:ae.dialogWidth},{default:(0,v.k6)((()=>[(0,v.Lk)("div",H,[(0,v.bF)(fe,{type:"primary",onClick:t[4]||(t[4]=e=>ae.handleDownload(te.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"download",style:{"margin-right":"3px"}}),t[32]||(t[32]=(0,v.eW)(" 下载 "))])),_:1}),(0,v.bF)(fe,{type:"primary",onClick:t[5]||(t[5]=e=>ae.handleBlock(te.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"ban",style:{"margin-right":"3px"}}),t[33]||(t[33]=(0,v.eW)(" 黑名单 "))])),_:1}),(0,v.bF)(fe,{type:"primary",onClick:t[6]||(t[6]=e=>ae.handleWhite(te.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"user-plus",style:{"margin-right":"3px"}}),t[34]||(t[34]=(0,v.eW)(" 白名单 "))])),_:1}),(0,v.bF)(fe,{type:"danger",onClick:t[7]||(t[7]=e=>ae.handleDetailDelete(te.detailFile?.name)),round:"",size:"small",class:"detail-action"},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"trash-alt",style:{"margin-right":"3px"}}),t[35]||(t[35]=(0,v.eW)(" 删除 "))])),_:1})]),(0,v.bF)(we,{modelValue:te.activeUrlTab,"onUpdate:modelValue":t[14]||(t[14]=e=>te.activeUrlTab=e),onTabClick:ae.handleTabClick,style:{"margin-bottom":"10px"}},{default:(0,v.k6)((()=>[(0,v.bF)(ve,{label:"原始链接",name:"originUrl"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:ae.allUrl.originUrl,"onUpdate:modelValue":t[8]||(t[8]=e=>ae.allUrl.originUrl=e),readonly:"",onClick:ae.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,v.bF)(ve,{label:"Markdown",name:"mdUrl"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:ae.allUrl.mdUrl,"onUpdate:modelValue":t[9]||(t[9]=e=>ae.allUrl.mdUrl=e),readonly:"",onClick:ae.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,v.bF)(ve,{label:"HTML",name:"htmlUrl"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:ae.allUrl.htmlUrl,"onUpdate:modelValue":t[10]||(t[10]=e=>ae.allUrl.htmlUrl=e),readonly:"",onClick:ae.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),(0,v.bF)(ve,{label:"BBCode",name:"bbUrl"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:ae.allUrl.bbUrl,"onUpdate:modelValue":t[11]||(t[11]=e=>ae.allUrl.bbUrl=e),readonly:"",onClick:ae.handleUrlClick},null,8,["modelValue","onClick"])])),_:1}),te.detailFile?.metadata?.TgFileId?((0,v.uX)(),(0,v.Wv)(ve,{key:0,label:"TG File ID",name:"tgId"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:ae.allUrl.tgId,"onUpdate:modelValue":t[12]||(t[12]=e=>ae.allUrl.tgId=e),readonly:"",onClick:ae.handleUrlClick},null,8,["modelValue","onClick"])])),_:1})):(0,v.Q3)("",!0),te.detailFile?.metadata?.S3Location?((0,v.uX)(),(0,v.Wv)(ve,{key:1,label:"S3 Location",name:"s3Location"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:ae.allUrl.S3Location,"onUpdate:modelValue":t[13]||(t[13]=e=>ae.allUrl.S3Location=e),readonly:"",onClick:ae.handleUrlClick},null,8,["modelValue","onClick"])])),_:1})):(0,v.Q3)("",!0)])),_:1},8,["modelValue","onTabClick"]),(0,v.bF)($e,{direction:"vertical",border:"",column:ae.tableColumnNum},{default:(0,v.k6)((()=>[(0,v.bF)(ye,{label:"文件预览",rowspan:ae.tablePreviewSpan,width:300,align:"center"},{default:(0,v.k6)((()=>[ae.isVideo(te.detailFile)?((0,v.uX)(),(0,v.CE)("video",{key:0,src:"/file/"+te.detailFile?.name+"?from=admin",autoplay:"",muted:"",loop:"",class:"video-preview",onClick:t[15]||(t[15]=(...e)=>ae.handleVideoClick&&ae.handleVideoClick(...e))},null,8,K)):ae.isImage(te.detailFile)?((0,v.uX)(),(0,v.Wv)(ge,{key:1,src:"/file/"+te.detailFile?.name+"?from=admin",fit:"cover",lazy:"",class:"image-preview"},null,8,["src"])):((0,v.uX)(),(0,v.Wv)(se,{key:2,icon:"file",class:"file-icon-detail"}))])),_:1},8,["rowspan"]),(0,v.bF)(ye,{label:"文件名","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.FileName||te.detailFile?.name),1)])),_:1}),(0,v.bF)(ye,{label:"文件类型","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.FileType||"未知"),1)])),_:1}),(0,v.bF)(ye,{label:"文件大小(MB)","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.FileSize||"未知"),1)])),_:1}),(0,v.bF)(ye,{label:"上传时间","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(new Date(te.detailFile?.metadata?.TimeStamp).toLocaleString()||"未知"),1)])),_:1}),(0,v.bF)(ye,{label:"访问状态","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(ae.accessType),1)])),_:1}),(0,v.bF)(ye,{label:"上传渠道","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.Channel||"未知"),1)])),_:1}),(0,v.bF)(ye,{label:"审查结果","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.Label||"无"),1)])),_:1}),(0,v.bF)(ye,{label:"上传IP","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.UploadIP||"未知"),1)])),_:1}),(0,v.bF)(ye,{label:"上传地址","class-name":"description-item"},{default:(0,v.k6)((()=>[(0,v.eW)((0,w.v_)(te.detailFile?.metadata?.UploadAddress||"未知"),1)])),_:1})])),_:1},8,["column"])])),_:1},8,["modelValue","width"]),(0,v.bF)(Le,{title:"链接格式",modelValue:te.showUrlDialog,"onUpdate:modelValue":t[21]||(t[21]=e=>te.showUrlDialog=e),width:ae.dialogWidth,"show-close":!1},{default:(0,v.k6)((()=>[t[46]||(t[46]=(0,v.Lk)("p",{style:{"font-size":"medium","font-weight":"bold"}},"默认复制链接",-1)),(0,v.bF)(Ue,{modelValue:te.defaultUrlFormat,"onUpdate:modelValue":t[17]||(t[17]=e=>te.defaultUrlFormat=e)},{default:(0,v.k6)((()=>[(0,v.bF)(Te,{label:"originUrl"},{default:(0,v.k6)((()=>t[36]||(t[36]=[(0,v.eW)("原始链接")]))),_:1}),(0,v.bF)(Te,{label:"mdUrl"},{default:(0,v.k6)((()=>t[37]||(t[37]=[(0,v.eW)("Markdown")]))),_:1}),(0,v.bF)(Te,{label:"htmlUrl"},{default:(0,v.k6)((()=>t[38]||(t[38]=[(0,v.eW)("HTML")]))),_:1}),(0,v.bF)(Te,{label:"bbUrl"},{default:(0,v.k6)((()=>t[39]||(t[39]=[(0,v.eW)("BBCode")]))),_:1}),(0,v.bF)(Te,{label:"tgId"},{default:(0,v.k6)((()=>t[40]||(t[40]=[(0,v.eW)("TG File ID")]))),_:1}),(0,v.bF)(Te,{label:"s3Location"},{default:(0,v.k6)((()=>t[41]||(t[41]=[(0,v.eW)("S3链接")]))),_:1})])),_:1},8,["modelValue"]),(0,v.Lk)("p",J,[t[42]||(t[42]=(0,v.eW)("自定义链接 ")),(0,v.bF)(de,{content:"默认链接为https://your.domain/file/xxx.jpg <br> 如果启用自定义链接格式，只保留xxx.jpg部分，其他部分请自行输入",placement:"top","raw-content":""},{default:(0,v.k6)((()=>[(0,v.bF)(se,{icon:"question-circle",class:"question-icon",size:"me"})])),_:1})]),(0,v.bF)(De,{"label-width":"25%"},{default:(0,v.k6)((()=>[(0,v.bF)(Ce,{label:"启用自定义"},{default:(0,v.k6)((()=>[(0,v.bF)(Ue,{modelValue:te.useCustomUrl,"onUpdate:modelValue":t[18]||(t[18]=e=>te.useCustomUrl=e)},{default:(0,v.k6)((()=>[(0,v.bF)(Te,{value:"true"},{default:(0,v.k6)((()=>t[43]||(t[43]=[(0,v.eW)("是")]))),_:1}),(0,v.bF)(Te,{value:"false"},{default:(0,v.k6)((()=>t[44]||(t[44]=[(0,v.eW)("否")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),"true"===te.useCustomUrl?((0,v.uX)(),(0,v.Wv)(Ce,{key:0,label:"自定义前缀"},{default:(0,v.k6)((()=>[(0,v.bF)(ie,{modelValue:te.customUrlPrefix,"onUpdate:modelValue":t[19]||(t[19]=e=>te.customUrlPrefix=e),placeholder:"请输入自定义链接前缀"},null,8,["modelValue"])])),_:1})):(0,v.Q3)("",!0)])),_:1}),(0,v.Lk)("div",Y,[(0,v.bF)(fe,{type:"primary",onClick:t[20]||(t[20]=e=>te.showUrlDialog=!1)},{default:(0,v.k6)((()=>t[45]||(t[45]=[(0,v.eW)("确定")]))),_:1})])])),_:1},8,["modelValue","width"])])}a(4114),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4603),a(7566),a(8721);var te=a(782),ae=a(4813),le=a.n(ae);class ie{constructor(){this.FILE_LIST_PATH="data/fileList.json"}getLocalFileList(){try{const e=localStorage.getItem(this.FILE_LIST_PATH);return e?JSON.parse(e):{files:[],directories:[]}}catch(e){return console.error("Error reading local file list:",e),{files:[],directories:[]}}}saveFileList(e){try{return localStorage.setItem(this.FILE_LIST_PATH,JSON.stringify(e)),!0}catch(t){return console.error("Error saving file list:",t),!1}}addFile(e){try{const t=this.getLocalFileList();return t.files.push(e),this.saveFileList(t)}catch(t){return console.error("Error adding file:",t),!1}}addFolder(e){try{const t=this.getLocalFileList();return!t.directories.includes(e)&&(t.directories.push(e),this.saveFileList(t))}catch(t){return console.error("Error adding folder:",t),!1}}moveFile(e,t,a=!1,l=""){try{let i=this.getLocalFileList();if(a){const t=i.directories.indexOf(e);-1!==t&&i.directories.splice(t,1)}else{const t=i.files.findIndex((t=>t.name===e));-1!==t&&i.files.splice(t,1)}if(t.startsWith(l)){const e=t.substring(l.length).split("/");if(e.length>1){const t=l+e[0];i.directories.includes(t)||i.directories.push(t)}}return this.saveFileList(i)}catch(i){return console.error("Error moving file:",i),!1}}removeFile(e){try{let t=this.getLocalFileList();return t.files=t.files.filter((t=>t.name!==e)),this.saveFileList(t)}catch(t){return console.error("Error removing file:",t),!1}}removeFolder(e){try{let t=this.getLocalFileList();return t.files=t.files.filter((t=>!t.name.startsWith(e+"/"))),t.directories=t.directories.filter((t=>t!==e)),this.saveFileList(t)}catch(t){return console.error("Error removing folder:",t),!1}}getFilesInFolder(e){try{const t=this.getLocalFileList(),a=t.files.filter((t=>t.name.startsWith(e+"/"))),l=t.directories.filter((t=>t.startsWith(e+"/")));return{files:a,directories:l}}catch(t){return console.error("Error getting files in folder:",t),{files:[],directories:[]}}}async refreshFileList(e,t){try{const a=await e(`/api/manage/list?count=60&dir=${t}`,{method:"GET"}),l=await a.json();return this.saveFileList(l)}catch(a){return console.error("Error refreshing file list:",a),!1}}async loadMoreFiles(e,t){try{const a=this.getLocalFileList(),l=a.files.length,i=await e(`/api/manage/list?dir=${t}&start=${l}&count=60`,{method:"GET"}),s=await i.json();return a.files.push(...s.files),this.saveFileList(a)}catch(a){return console.error("Error loading more files:",a),{files:[],directories:[]}}}}const se=new ie;var ne={data(){return{Number:0,showLogoutButton:!1,tableData:[],search:"",currentPage:1,pageSize:15,selectedFiles:[],sortOption:"dateDesc",isUploading:!1,showdetailDialog:!1,detailFile:null,activeUrlTab:"originUrl",defaultUrlFormat:"originUrl",showUrlDialog:!1,useCustomUrl:"false",customUrlPrefix:"",loading:!1,currentPath:"",refreshLoading:!1}},components:{DashboardTabs:k.A},computed:{...(0,te.L8)(["credentials","adminUrlSettings","userConfig"]),filteredTableData(){return this.tableData.filter((e=>!this.search||e.name.toLowerCase().includes(this.search.toLowerCase())||e.metadata?.FileName?.toLowerCase().includes(this.search.toLowerCase())))},paginatedTableData(){const e=this.sortData(this.filteredTableData),t=(this.currentPage-1)*this.pageSize,a=t+this.pageSize;let l=e.slice(t,a);const i=l.filter((e=>e.metadata?.FileType?.includes("image"))).map((e=>`/file/${e.name}?from=admin`));return l.forEach((e=>{e.metadata?.FileType?.includes("video")||(e.previewSrcList=i.slice(i.indexOf(`/file/${e.name}?from=admin`)).concat(i.slice(0,i.indexOf(`/file/${e.name}?from=admin`))))})),l.forEach((e=>{"TelegramNew"===e.metadata?.Channel?e.channelTag="TG":"CloudflareR2"===e.metadata?.Channel?e.channelTag="R2":"S3"===e.metadata?.Channel?e.channelTag="S3":"External"===e.metadata?.Channel?e.channelTag="外链":e.channelTag="未知"})),l},sortIcon(){return"dateDesc"===this.sortOption?"sort-amount-down":"sort-alpha-up"},dialogWidth(){return window.innerWidth>768?"50%":"90%"},accessType(){return"White"===this.detailFile?.metadata?.ListType?"正常":"Block"===this.detailFile?.metadata?.ListType||"adult"===this.detailFile?.metadata?.Label?"受限":"正常"},allUrl(){return"External"===this.detailFile?.metadata?.Channel?{originUrl:`${this.detailFile?.metadata?.ExternalLink}`,mdUrl:`![${this.detailFile?.metadata?.FileName||this.detailFile?.name}](${this.detailFile?.metadata?.ExternalLink})`,htmlUrl:`<img src="${this.detailFile?.metadata?.ExternalLink}" alt="${this.detailFile?.metadata?.FileName||this.detailFile?.name}" width=100%>`,bbUrl:`[img]${this.detailFile?.metadata?.ExternalLink}[/img]`,tgId:this.detailFile?.metadata?.TgFileId||"未知",S3Location:this.detailFile?.metadata?.S3Location||"未知"}:{originUrl:`${this.rootUrl}${this.detailFile?.name}`,mdUrl:`![${this.detailFile?.metadata?.FileName||this.detailFile?.name}](${this.rootUrl}${this.detailFile?.name})`,htmlUrl:`<img src="${this.rootUrl}${this.detailFile?.name}" alt="${this.detailFile?.metadata?.FileName||this.detailFile?.name}" width=100%>`,bbUrl:`[img]${this.rootUrl}${this.detailFile?.name}[/img]`,tgId:this.detailFile?.metadata?.TgFileId||"未知",S3Location:this.detailFile?.metadata?.S3Location||"未知"}},tableColumnNum(){return window.innerWidth>768?3:1},tablePreviewSpan(){return window.innerWidth>768?2:1},disableTooltip(){return window.innerWidth<768},selectPage(){return this.paginatedTableData.every((e=>e.selected))},selectedPageFiles(){return this.paginatedTableData.some((e=>e.selected))},selectPageIcon(){return this.selectPage?"check-square":this.selectedPageFiles?"minus-square":"square"},rootUrl(){return"true"===this.useCustomUrl?this.customUrlPrefix:this.userConfig?.urlPrefix||`${document.location.origin}/file/`}},watch:{tableData:{handler(e){this.selectedFiles=this.selectedFiles.concat(e.filter((e=>e.selected&&!this.selectedFiles.includes(e)))),this.selectedFiles=this.selectedFiles.filter((e=>e.selected)),this.selectedFiles=this.selectedFiles.filter((t=>e.includes(t)))},deep:!0},sortOption(e){localStorage.setItem("sortOption",e)},defaultUrlFormat(e){localStorage.setItem("defaultUrlFormat",e)},showdetailDialog(e){e&&(this.activeUrlTab=this.defaultUrlFormat||"originUrl")},customUrlPrefix(e){this.$store.commit("setAdminUrlSettings",{key:"customUrlPrefix",value:e})},useCustomUrl(e){this.$store.commit("setAdminUrlSettings",{key:"useCustomUrl",value:e})},currentPath(e){this.tableData.forEach((e=>e.selected=!1))}},methods:{showFullScreen(){this.$router.push("/fallImg")},handleDownload(e){const t=document.createElement("a");t.href=`/file/${e}?from=admin`,t.download=e,t.click()},openDetailDialog(e,t){this.detailFile=this.paginatedTableData[e],this.showdetailDialog=!0},handleTabClick(e){this.activeUrlTab=e.props.name},handleUrlClick(e){navigator.clipboard.writeText(e.target.value).then((()=>{this.$message({type:"success",message:"复制成功"})})).catch((()=>{this.$message({type:"error",message:"复制失败"})}))},handleDetailDelete(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/delete/${e}`,{method:"GET"}).then((t=>{if(!t.ok)return Promise.reject("请求失败");{const t=this.tableData.findIndex((t=>t.name===e));-1!==t&&this.tableData.splice(t,1)}})).then((()=>{this.updateStats(-1,!1),this.$message.success("删除成功!"),this.showdetailDialog=!1})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBlock(e){this.$confirm("此操作将把该文件加入黑名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/block/${e}`,{method:"GET"}).then((t=>{if(!t.ok)return Promise.reject("请求失败");{const t=this.tableData.findIndex((t=>t.name===e));-1!==t&&(this.tableData[t].metadata.ListType="Block")}})).then((()=>{this.$message.success("加入黑名单成功!")})).catch((()=>this.$message.error("加入黑名单失败，请检查网络连接")))})).catch((()=>console.log("已取消加入黑名单")))},handleWhite(e){this.$confirm("此操作将把该文件加入白名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/white/${e}`,{method:"GET"}).then((t=>{if(!t.ok)return Promise.reject("请求失败");{const t=this.tableData.findIndex((t=>t.name===e));-1!==t&&(this.tableData[t].metadata.ListType="White")}})).then((()=>{this.$message.success("加入白名单成功!")})).catch((()=>this.$message.error("加入白名单失败，请检查网络连接")))})).catch((()=>console.log("已取消加入白名单")))},async fetchWithAuth(e,t={}){this.credentials&&(t.headers={...t.headers,Authorization:`Basic ${this.credentials}`},t.credentials="include");const a=await fetch(e,t);if(401===a.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return a},handleDelete(e,t){const a=this.tableData.find((e=>e.name===t)).isFolder;this.$confirm(`此操作将永久删除${a?"文件夹":"该文件"}, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.fetchWithAuth(`/api/manage/delete/${t}?folder=${a}`,{method:"GET"}).then((e=>{if(!e.ok)return Promise.reject("请求失败");{const e=this.tableData.findIndex((e=>e.name===t));-1!==e&&this.tableData.splice(e,1)}})).then((()=>{this.updateStats(-1,!1),se.removeFile(t),this.$message.success("删除成功!")})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBatchDelete(){this.$confirm("此操作将永久删除选中的文件及文件夹, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>{const t=e.isFolder;return this.fetchWithAuth(`/api/manage/delete/${e.name}?folder=${t}`,{method:"GET"})}));Promise.all(e).then((e=>{let t=0;e.forEach(((e,a)=>{if(e.ok){t++;const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[a].name));-1!==e&&this.tableData.splice(e,1),se.removeFile(this.selectedFiles[a].name)}})),this.selectedFiles=[],this.updateStats(-t,!1),this.$message.success("批量删除成功!")})).catch((()=>this.$message.error("批量删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量删除")))},handleBatchCopy(){let e="";switch(this.defaultUrlFormat){case"originUrl":e=this.selectedFiles.map((e=>e.isFolder?"":"External"===e.metadata?.Channel?e.metadata?.ExternalLink:`${this.rootUrl}${e.name}`)).join("\n");break;case"mdUrl":e=this.selectedFiles.map((e=>e.isFolder?"":"External"===e.metadata?.Channel?`![${e.metadata?.FileName||e.name}](${e.metadata?.ExternalLink})`:`![${e.metadata?.FileName||e.name}](${this.rootUrl}${e.name})`)).join("\n");break;case"htmlUrl":e=this.selectedFiles.map((e=>e.isFolder?"":"External"===e.metadata?.Channel?`<img src="${e.metadata?.ExternalLink}" alt="${e.metadata?.FileName||e.name}" width=100%>`:`<img src="${this.rootUrl}${e.name}" alt="${e.metadata?.FileName||e.name}" width=100%>`)).join("\n");break;case"bbUrl":e=this.selectedFiles.map((e=>e.isFolder?"":"External"===e.metadata?.Channel?`[img]${e.metadata?.ExternalLink}[/img]`:`[img]${this.rootUrl}${e.name}[/img]`)).join("\n");break;case"tgId":e=this.selectedFiles.map((e=>e.metadata?.TgFileId||"")).join("\n");break;case"s3Location":e=this.selectedFiles.map((e=>e.metadata?.S3Location||"")).join("\n");break}e=e.replace(/^\s*[\r\n]/gm,"");const t=e;navigator.clipboard?navigator.clipboard.writeText(t).then((()=>this.$message.success("批量复制链接成功~"))):this.copyToClipboardFallback(t)},copyToClipboardFallback(e){const t=document.createElement("textarea");document.body.appendChild(t),t.style.position="fixed",t.style.clip="rect(0 0 0 0)",t.style.top="10px",t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t),this.$message.success("批量复制链接成功~")},handleCopy(e,t){let a="";if("External"===this.paginatedTableData[e].metadata?.Channel)switch(this.defaultUrlFormat){case"originUrl":a=this.paginatedTableData[e].metadata?.ExternalLink;break;case"mdUrl":a=`![${this.paginatedTableData[e].metadata?.FileName||t}](${this.paginatedTableData[e].metadata?.ExternalLink})`;break;case"htmlUrl":a=`<img src="${this.paginatedTableData[e].metadata?.ExternalLink}" alt="${this.paginatedTableData[e].metadata?.FileName||t}" width=100%>`;break;case"bbUrl":a=`[img]${this.paginatedTableData[e].metadata?.ExternalLink}[/img]`;break;case"tgId":a=this.paginatedTableData[e].metadata?.TgFileId||"none";break;case"s3Location":a=this.paginatedTableData[e].metadata?.S3Location||"none";break}else switch(this.defaultUrlFormat){case"originUrl":a=`${this.rootUrl}${t}`;break;case"mdUrl":a=`![${this.paginatedTableData[e].metadata?.FileName||t}](${this.rootUrl}${t})`;break;case"htmlUrl":a=`<img src="${this.rootUrl}${t}" alt="${this.paginatedTableData[e].metadata?.FileName||t}" width=100%>`;break;case"bbUrl":a=`[img]${this.rootUrl}${t}[/img]`;break;case"tgId":a=this.paginatedTableData[e].metadata?.TgFileId||"none";break;case"s3Location":a=this.paginatedTableData[e].metadata?.S3Location||"none";break}navigator.clipboard?navigator.clipboard.writeText(a).then((()=>this.$message.success("复制文件链接成功~"))):this.copyToClipboardFallback(a)},async loadMoreData(){this.loading=!0;try{await se.loadMoreFiles(this.fetchWithAuth,this.currentPath),await this.fetchFileList()}catch(e){this.$message.error("加载更多文件失败，请检查网络连接")}finally{this.loading=!1}},updateStats(e,t=!1){t?this.fetchWithAuth(`/api/manage/list?count=-1&sum=true&dir=${this.currentPath}`,{method:"GET"}).then((e=>e.json())).then((e=>{this.Number=e.sum})).catch((()=>this.$message.error("更新统计信息失败，请检查网络连接"))):this.Number+=e},sort(e){this.sortOption=e},sortData(e){const t=e.filter((e=>e.isFolder)),a=e.filter((e=>!e.isFolder));return"dateDesc"===this.sortOption?(t.sort(((e,t)=>new Date(t.metadata?.TimeStamp)-new Date(e.metadata?.TimeStamp))),a.sort(((e,t)=>new Date(t.metadata?.TimeStamp)-new Date(e.metadata?.TimeStamp)))):(t.sort(((e,t)=>e.name.localeCompare(t.name))),a.sort(((e,t)=>e.name.localeCompare(t.name)))),t.concat(a)},handleVideoClick(e){const t=e.target;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},handleSelectPage(){this.selectPage?this.paginatedTableData.forEach((e=>e.selected=!1)):this.paginatedTableData.forEach((e=>e.selected=!0))},handleBatchAction(e){"copy"===e?this.handleBatchCopy():"delete"===e?this.handleBatchDelete():"download"===e?this.handleBatchDownload():"move"===e?this.handleBatchMove():"ban"===e?this.handleBatchBlock():"white"===e&&this.handleBatchWhite()},handleMove(e,t){this.$prompt("请输入新的目录","移动文件",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\/([a-zA-Z0-9_\u4e00-\u9fa5]+(\/[a-zA-Z0-9_\u4e00-\u9fa5]+)*)?$/,inputErrorMessage:"请输入/开头的正确目录路径"}).then((({value:e})=>{const a=e.replace(/^\/+/,"")+(e.endsWith("/")||""===e?"":"/"),l=this.tableData.find((e=>e.name===t)).isFolder;a!==this.currentPath?this.fetchWithAuth(`/api/manage/move/${t}?folder=${l}&dist=${a}`,{method:"GET"}).then((e=>{if(!e.ok)return Promise.reject("请求失败");{const e=this.tableData.findIndex((e=>e.name===t));if(-1!==e){const i=a+t.split("/").pop();se.moveFile(t,i,l,this.currentPath),this.tableData.splice(e,1),this.$nextTick((()=>{const e=[...this.tableData];this.tableData=[],this.$nextTick((()=>{this.tableData=e}))}))}this.updateStats(-1,!1),this.$message.success("移动成功!")}})).then((()=>{this.refreshLocalFileList()})).catch((()=>this.$message.error("移动失败，请检查网络连接"))):this.$message.warning("目标文件夹不能是当前文件夹")})).catch((()=>this.$message.info("已取消移动文件")))},handleBatchMove(){this.$prompt("请输入新的目录","移动文件",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\/([a-zA-Z0-9_\u4e00-\u9fa5]+(\/[a-zA-Z0-9_\u4e00-\u9fa5]+)*)?$/,inputErrorMessage:"请输入/开头的正确目录路径"}).then((({value:e})=>{const t=e.replace(/^\/+/,"")+(e.endsWith("/")||""===e?"":"/");if(t===this.currentPath)return void this.$message.warning("目标文件夹不能是当前文件夹");const a=this.selectedFiles.map((e=>{const a=e.isFolder;return this.fetchWithAuth(`/api/manage/move/${e.name}?folder=${a}&dist=${t}`,{method:"GET"})}));Promise.all(a).then((e=>{let a=0;e.forEach(((e,l)=>{if(e.ok){a++;const e=this.selectedFiles[l];e.selected=!1;const i=this.tableData.findIndex((t=>t.name===e.name));if(-1!==i){const a=t+e.name.split("/").pop();se.moveFile(e.name,a,e.isFolder,this.currentPath),this.tableData.splice(i,1)}}})),this.$nextTick((()=>{const e=[...this.tableData];this.tableData=[],this.$nextTick((()=>{this.tableData=e}))})),this.updateStats(-a,!1),this.$message.success("移动成功!")})).then((()=>{this.refreshLocalFileList()})).catch((()=>this.$message.error("移动失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消移动文件")))},handleBatchBlock(){this.$confirm("此操作将把选中的文件加入黑名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>e.isFolder?Promise.resolve({ok:!1}):this.fetchWithAuth(`/api/manage/block/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{e.forEach(((e,t)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[t].name));-1!==e&&(this.tableData[e].metadata.ListType="Block")}})),this.$message.success("批量加入黑名单成功!")})).catch((()=>this.$message.error("批量加入黑名单失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量加入黑名单")))},handleBatchWhite(){this.$confirm("此操作将把选中的文件加入白名单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>e.isFolder?Promise.resolve({ok:!1}):this.fetchWithAuth(`/api/manage/white/${e.name}`,{method:"GET"})));Promise.all(e).then((e=>{e.forEach(((e,t)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[t].name));-1!==e&&(this.tableData[e].metadata.ListType="White")}})),this.$message.success("批量加入白名单成功!")})).catch((()=>this.$message.error("批量加入白名单失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量加入白名单")))},handleBatchDownload(){const e=new(le()),t=e.folder("files"),a={},l=this.selectedFiles.map((async e=>{if(e.isFolder)return;const l=await fetch(`/file/${e.name}?from=admin`),i=await l.blob();let s=e.metadata?.FileName||e.name;if(a[s]){const t=s.substring(s.lastIndexOf(".")),l=s.substring(0,s.lastIndexOf("."));s=`${l}(${a[s]})${t}`,a[e.name]++}else a[s]=1;t.file(s,i)}));Promise.all(l).then((()=>e.generateAsync({type:"blob"}))).then((e=>{const t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="files.zip",t.click()}))},isVideo(e){let t=e.metadata?.FileType?.includes("video")||e.metadata?.FileType?.includes("audio");if(!t){const a=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","rmvb","3gp","mpg","mpeg","m4v","f4v","rm","asf","dat","ts","vob","swf","divx","xvid","m2ts","mts","m2v","3g2","3gp2","3gpp","3gpp2","mpe","m1v","mpv","mpv2","mp2v","m2t","m2ts","m2v","m4b","m4p","m4v","m4r"],l=e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase();t=a.includes(l)}return t},isImage(e){let t=e.metadata?.FileType?.includes("image");if(!t){const a=["jpg","jpeg","png","gif","bmp","webp","svg","ico","tiff","tif","psd","ai","eps","raw","cr2","nef","orf","sr2","dng","arw","rw2","raf","pef","x3f","srf","erf","mrw","nrw","kdc","dcr","mef","mos","crw","raf","rwl","srw","3fr","fff","iiq","qtk","bay","k25","kdc","dcs","drf","dng","erf","kdc","mdc","mef","mos","mrw","nef","nrw","orf","pef","ptx","pxn","r3d","raf","raw","rwl","rw2","rwz","sr2","srf","x3f"],l=e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase();t=a.includes(l)}return t},handlePageChange(e){this.currentPage=e,this.currentPage===Math.ceil(this.filteredTableData.length/this.pageSize)&&this.loadMoreData()},isFolder(e){if(e.isFolder)return!0;let t=e.name;if(t.startsWith("http")&&(t=t.split("/file/")[1]),t&&t.includes("/")){const e=this.currentPath?t.substring(this.currentPath.length):t;return""===this.currentPath?!t.split("/")[0].includes("."):e.includes("/")}return!1},getFolderName(e){let t="";if(e&&e.includes("/")){const a=e.split("/");if(""===this.currentPath)t=a[0];else{const a=e.substring(this.currentPath.length);t=a.split("/")[0]}}else t=e;const a=20;if(t.length>a){const e=Math.floor((a-3)/2),l=Math.ceil((a-3)/2);return`${t.substring(0,e)}...${t.substring(t.length-l)}`}return t},getFileName(e){let t=e.split("/").pop();const a=20;if(t.length>a){const e=Math.floor((a-3)/2),l=Math.ceil((a-3)/2);return`${t.substring(0,e)}...${t.substring(t.length-l)}`}return t},enterFolder(e){this.currentPath=e+(e.endsWith("/")?"":"/"),this.refreshFileList()},navigateToFolder(e){this.currentPath=e?e+(e.endsWith("/")?"":"/"):"",this.refreshFileList()},async fetchFileList(){this.loading=!0;try{const e=se.getLocalFileList(),t=new Set(e.directories||[]),a=e.files||[],l=Array.from(t).map((e=>({name:e,isFolder:!0,selected:!1,metadata:{FileName:e.split("/").pop()}}))),i=a.map((e=>({name:e.name,isFolder:!1,selected:!1,metadata:e.metadata})));this.tableData=[...l,...i],this.updateStats(0,!0)}catch(e){console.error("Error fetching file list:",e),this.$message.error("获取文件列表失败")}finally{this.loading=!1}},async refreshFileList(){this.refreshLoading=!0,this.loading=!0;try{const e=await se.refreshFileList(this.fetchWithAuth,this.currentPath);if(!e)throw new Error("Refresh failed");await this.fetchFileList()}catch(e){console.error("Error refreshing file list:",e),this.$message.error("刷新失败，请重试")}finally{this.refreshLoading=!1,this.loading=!1}},async refreshLocalFileList(){this.refreshLoading=!0,this.loading=!0;try{await this.fetchFileList()}catch(e){console.error("Error refreshing local file list:",e),this.$message.error("刷新失败，请重试")}finally{this.refreshLoading=!1,this.loading=!1}}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)return this.showLogoutButton=!0,!0;if("Not using basic auth."==e)return!0;throw new Error("Unauthorized")})).then((()=>this.refreshFileList())).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")})).finally((()=>{this.loading=!1})),this.customUrlPrefix=this.adminUrlSettings.customUrlPrefix,this.useCustomUrl=this.adminUrlSettings.useCustomUrl}},re=a(1241);const oe=(0,re.A)(ne,[["render",ee],["__scopeId","data-v-6e7324f3"]]);var de=oe}}]);
//# sourceMappingURL=349.63dee5a9.js.map